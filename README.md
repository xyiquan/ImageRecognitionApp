# Image Recognition App

## Setup Steps
1. Reserve resources on GENI using Rspec file <a href="https://github.com/xyiquan/ImageRecognitionApp/raw/master/rspec_geni_project.xml">rspec_geni_project.xml</a>.
   1. Ensure webserver has a public IP.
1. Setup Webserver
   1. SSH into Webserver and run environment setup script:
      1. Run: wget https://github.com/xyiquan/ImageRecognitionApp/raw/master/setupEnvWebserver.sh
      1. Run: sh setupEnvWebserver.sh
   1. Go to ./geni_project/webserver/ and update the IP of APIserver in <a href="https://github.com/xyiquan/ImageRecognitionApp/tree/master/webserver">config.txt</a>.
   1. Run "python3 webserver.py".
1. Setup APIserver  
   1. SSH into APIserver and run environment setup script:
      1. Run: wget https://github.com/xyiquan/ImageRecognitionApp/raw/master/setupEnvAPIserver.sh
      1. Run: sh setupEnvAPIserver.sh
   1. Go to ./geni_project/apiserver/ and run "python3 apiserver.py"
      1. Note: If there is an error about Numpy, run "pip3 uninstall numpy" a few times until there is no more numpy installations, then install by running "pip3 install --user numpy"
1. Access the app at http://"webserver public IP":5000/

## Experiment Steps

### Effect of Image Size and Link Speed on Server-to-Server Response Time

Purpose: To find out how server-to-server response time (i.e. time taken for HTTP request/response from Web Server to API Server to call image classification service) is affected by different image sizes and link speeds.

Approach:
1. 5 image sizes were used varying from 0.69MB to 17.1MB (<a href="https://github.com/xyiquan/ImageRecognitionApp/tree/master/images">link</a>). The 4 smaller images were generated by downsizing the original image by 4 different factors (80%, 60%, 40%, 20%) and saving each as a separate copy.
1.	5 link speeds were used - 1Gbps (Uncapped), 80Mbps, 60Mbps, 40Mbps, 20Mbps. Linuxâ€™s tc qdisc tbf was used to limit the link speed for eth1 network interface on Web Server:
     1. "tc qdisc show dev eth1" should show: qdisc fq_codel 0: root refcnt 2 limit 10240p flows 1024 quantum 1514 target 5.0ms interval 100.0ms memory_limit 32Mb ecn
     1. sudo tc qdisc add dev eth1 root tbf rate 80000kbit latency 50ms burst 1540
     1. "tc qdisc show dev eth1" should show: qdisc tbf 8001: root refcnt 2 rate 1024Kbit burst 1539b lat 50.0ms
     1. Run experiment for 5 image sizes (5 runs each), record stats in Excel.
     1. sudo tc qdisc del dev eth1 root
     1. sudo tc qdisc add dev eth1 root tbf rate 60000kbit latency 50ms burst 1540
     1. Run experiment for 5 image sizes (5 runs each), record stats in Excel.
     1. sudo tc qdisc del dev eth1 root
     1. sudo tc qdisc add dev eth1 root tbf rate 40000kbit latency 50ms burst 1540
     1. Run experiment for 5 image sizes (5 runs each), record stats in Excel.
     1. sudo tc qdisc del dev eth1 root
     1. sudo tc qdisc add dev eth1 root tbf rate 20000kbit latency 50ms burst 1540
     1. Run experiment for 5 image sizes (5 runs each), record stats in Excel.
     1. sudo tc qdisc del dev eth1 root
1. A localhost setup was also done to see how much of the response time is not due to network.
1.	The web interface was used to upload the 5 different image sizes (5 runs each) and record the response times displayed in an Excel file. This whole set is repeated 5 times for 5 link speeds (after using tc qdisc to change, detailed steps on GitHub). Statistics gathered are plotted in a chart in Results section.

### Effect of Concurrent Requests on Server-to-Server Response Time

Purpose:
To find out how server-to-server response time is affected by the number of concurrent requests.

Approach:
1. Vary the number of concurrent requests from 1 to 7.
1. Open the respective number of tabs in a browser, loading the files in each tab, followed by clicking on submit in each tab one after another. All the response times for each tab is averaged and this counts as 1 run.
1. Each number of concurrent uploads is repeated in 5 runs and further averaged. The response times reported are recorded in an Excel file and charted in a graph in Results section.
